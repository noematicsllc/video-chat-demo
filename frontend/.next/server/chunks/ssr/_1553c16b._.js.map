{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../hooks/useAuth.ts","../../../../lib/auth.ts","../../../../app/auth/callback/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","/** Custom hook for Zitadel authentication. */\n\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport {\n  storeToken,\n  getToken,\n  clearToken,\n  decodeToken,\n  getUserFromToken,\n  type User,\n} from '@/lib/auth';\n\nconst ZITADEL_ISSUER_URL =\n  process.env.NEXT_PUBLIC_ZITADEL_ISSUER_URL || '';\nconst ZITADEL_CLIENT_ID =\n  process.env.NEXT_PUBLIC_ZITADEL_CLIENT_ID || '';\n\nexport function useAuth() {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState<string | null>(null);\n\n  // Check if Zitadel is configured\n  const hasZitadelConfig = !!(ZITADEL_ISSUER_URL && ZITADEL_CLIENT_ID);\n\n  useEffect(() => {\n    const initializeAuth = () => {\n      // Check if we have a token in localStorage\n      const storedToken = getToken();\n      if (storedToken) {\n        setToken(storedToken);\n        const decodedUser = decodeToken(storedToken);\n        if (decodedUser) {\n          setUser(decodedUser);\n        } else {\n          // Clear invalid token\n          clearToken();\n          setToken(null);\n          setUser(null);\n        }\n      } else {\n        setToken(null);\n        setUser(null);\n      }\n      setLoading(false);\n    };\n\n    initializeAuth();\n  }, []);\n\n  const login = () => {\n    // If Zitadel is not configured, do nothing\n    if (!hasZitadelConfig) {\n      console.warn('Zitadel is not configured');\n      return;\n    }\n\n    // OAuth2 Authorization Code flow\n    const redirectUri = encodeURIComponent(\n      typeof window !== 'undefined'\n        ? `${window.location.origin}/auth/callback`\n        : ''\n    );\n    const state = Math.random().toString(36).substring(7);\n    \n    // Store state for validation (optional, for production use)\n    if (typeof window !== 'undefined') {\n      sessionStorage.setItem('oauth_state', state);\n    }\n\n    const authUrl = `${ZITADEL_ISSUER_URL}/oauth/v2/authorize?` +\n      `client_id=${ZITADEL_CLIENT_ID}&` +\n      `redirect_uri=${redirectUri}&` +\n      `response_type=code&` +\n      `scope=openid profile email&` +\n      `state=${state}`;\n\n    if (typeof window !== 'undefined') {\n      window.location.href = authUrl;\n    }\n  };\n\n  const logout = () => {\n    clearToken();\n    setToken(null);\n    setUser(null);\n  };\n\n  const setAuthToken = (newToken: string) => {\n    storeToken(newToken);\n    setToken(newToken);\n    const decodedUser = decodeToken(newToken);\n    if (decodedUser) {\n      setUser(decodedUser);\n    }\n  };\n\n  return {\n    user,\n    token,\n    loading,\n    isAuthenticated: !!user && !!token,\n    login,\n    logout,\n    setAuthToken,\n  };\n}\n\n","/** Authentication utilities for Zitadel OAuth. */\n\nexport interface User {\n  sub: string;\n  name?: string;\n  preferred_username?: string;\n  email?: string;\n}\n\nconst AUTH_TOKEN_KEY = 'auth_token';\n\n/**\n * Store authentication token in localStorage.\n */\nexport function storeToken(token: string): void {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem(AUTH_TOKEN_KEY, token);\n  }\n}\n\n/**\n * Retrieve authentication token from localStorage.\n */\nexport function getToken(): string | null {\n  if (typeof window !== 'undefined') {\n    return localStorage.getItem(AUTH_TOKEN_KEY);\n  }\n  return null;\n}\n\n/**\n * Remove authentication token from localStorage.\n */\nexport function clearToken(): void {\n  if (typeof window !== 'undefined') {\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n  }\n}\n\n/**\n * Decode JWT token to extract user information.\n */\nexport function decodeToken(token: string): User | null {\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    return {\n      sub: payload.sub,\n      name: payload.name,\n      preferred_username: payload.preferred_username,\n      email: payload.email,\n    };\n  } catch (e) {\n    console.error('Failed to decode token:', e);\n    return null;\n  }\n}\n\n/**\n * Get user information from stored token.\n */\nexport function getUserFromToken(): User | null {\n  const token = getToken();\n  if (!token) {\n    return null;\n  }\n  return decodeToken(token);\n}\n\n","/** OAuth callback handler for Zitadel authentication. */\n\n'use client';\n\nimport { useEffect, useState, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useAuth } from '@/hooks/useAuth';\n\nfunction CallbackContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { setAuthToken } = useAuth();\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      // Check for error in URL\n      const errorParam = searchParams.get('error');\n      if (errorParam) {\n        setError(`Authentication error: ${errorParam}`);\n        setTimeout(() => router.push('/'), 3000);\n        return;\n      }\n\n      // Get authorization code from URL\n      const code = searchParams.get('code');\n      if (!code) {\n        setError('No authorization code received');\n        setTimeout(() => router.push('/'), 3000);\n        return;\n      }\n\n      try {\n        // Exchange code for token via API route\n        const redirectUri = `${window.location.origin}/auth/callback`;\n        const response = await fetch('/api/auth/token', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            code,\n            redirectUri,\n          }),\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json();\n          throw new Error(errorData.error || 'Token exchange failed');\n        }\n\n        const data = await response.json();\n        \n        if (!data.token) {\n          throw new Error('No token received from server');\n        }\n\n        // Store token and redirect\n        setAuthToken(data.token);\n        router.push('/');\n      } catch (err) {\n        console.error('Callback error:', err);\n        setError(err instanceof Error ? err.message : 'Authentication failed');\n        setTimeout(() => router.push('/'), 3000);\n      }\n    };\n\n    handleCallback();\n  }, [searchParams, router, setAuthToken]);\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center p-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-bold text-destructive mb-4\">\n            Authentication Error\n          </h1>\n          <p className=\"text-muted-foreground\">{error}</p>\n          <p className=\"text-sm text-muted-foreground mt-4\">\n            Redirecting to home page...\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n        <p className=\"text-muted-foreground\">Completing authentication...</p>\n      </div>\n    </div>\n  );\n}\n\nexport default function AuthCallbackPage() {\n  return (\n    <Suspense\n      fallback={\n        <div className=\"min-h-screen flex items-center justify-center p-4\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n            <p className=\"text-muted-foreground\">Loading...</p>\n          </div>\n        </div>\n      }\n    >\n      <CallbackContent />\n    </Suspense>\n  );\n}\n\n"],"names":["module","exports","require","vendored","ReactJsxRuntime"],"mappings":"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","ignoreList":[0]}