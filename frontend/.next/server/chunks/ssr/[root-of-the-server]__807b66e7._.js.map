{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-dom.ts","../../../../hooks/useAuth.ts","../../../../lib/auth.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactDOM\n","/** Custom hook for Zitadel authentication. */\n\n'use client';\n\nimport { useEffect, useState } from 'react';\nimport {\n  storeToken,\n  getToken,\n  clearToken,\n  decodeToken,\n  getUserFromToken,\n  type User,\n} from '@/lib/auth';\n\nconst ZITADEL_ISSUER_URL =\n  process.env.NEXT_PUBLIC_ZITADEL_ISSUER_URL || '';\nconst ZITADEL_CLIENT_ID =\n  process.env.NEXT_PUBLIC_ZITADEL_CLIENT_ID || '';\n\nexport function useAuth() {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [token, setToken] = useState<string | null>(null);\n\n  // Check if Zitadel is configured\n  const hasZitadelConfig = !!(ZITADEL_ISSUER_URL && ZITADEL_CLIENT_ID);\n\n  useEffect(() => {\n    const initializeAuth = () => {\n      // Check if we have a token in localStorage\n      const storedToken = getToken();\n      if (storedToken) {\n        setToken(storedToken);\n        const decodedUser = decodeToken(storedToken);\n        if (decodedUser) {\n          setUser(decodedUser);\n        } else {\n          // Clear invalid token\n          clearToken();\n          setToken(null);\n          setUser(null);\n        }\n      } else {\n        setToken(null);\n        setUser(null);\n      }\n      setLoading(false);\n    };\n\n    initializeAuth();\n  }, []);\n\n  const login = () => {\n    // If Zitadel is not configured, do nothing\n    if (!hasZitadelConfig) {\n      console.warn('Zitadel is not configured');\n      return;\n    }\n\n    // OAuth2 Authorization Code flow\n    const redirectUri = encodeURIComponent(\n      typeof window !== 'undefined'\n        ? `${window.location.origin}/auth/callback`\n        : ''\n    );\n    const state = Math.random().toString(36).substring(7);\n    \n    // Store state for validation (optional, for production use)\n    if (typeof window !== 'undefined') {\n      sessionStorage.setItem('oauth_state', state);\n    }\n\n    const authUrl = `${ZITADEL_ISSUER_URL}/oauth/v2/authorize?` +\n      `client_id=${ZITADEL_CLIENT_ID}&` +\n      `redirect_uri=${redirectUri}&` +\n      `response_type=code&` +\n      `scope=openid profile email&` +\n      `state=${state}`;\n\n    if (typeof window !== 'undefined') {\n      window.location.href = authUrl;\n    }\n  };\n\n  const logout = () => {\n    clearToken();\n    setToken(null);\n    setUser(null);\n  };\n\n  const setAuthToken = (newToken: string) => {\n    storeToken(newToken);\n    setToken(newToken);\n    const decodedUser = decodeToken(newToken);\n    if (decodedUser) {\n      setUser(decodedUser);\n    }\n  };\n\n  return {\n    user,\n    token,\n    loading,\n    isAuthenticated: !!user && !!token,\n    login,\n    logout,\n    setAuthToken,\n  };\n}\n\n","/** Authentication utilities for Zitadel OAuth. */\n\nexport interface User {\n  sub: string;\n  name?: string;\n  preferred_username?: string;\n  email?: string;\n}\n\nconst AUTH_TOKEN_KEY = 'auth_token';\n\n/**\n * Store authentication token in localStorage.\n */\nexport function storeToken(token: string): void {\n  if (typeof window !== 'undefined') {\n    localStorage.setItem(AUTH_TOKEN_KEY, token);\n  }\n}\n\n/**\n * Retrieve authentication token from localStorage.\n */\nexport function getToken(): string | null {\n  if (typeof window !== 'undefined') {\n    return localStorage.getItem(AUTH_TOKEN_KEY);\n  }\n  return null;\n}\n\n/**\n * Remove authentication token from localStorage.\n */\nexport function clearToken(): void {\n  if (typeof window !== 'undefined') {\n    localStorage.removeItem(AUTH_TOKEN_KEY);\n  }\n}\n\n/**\n * Decode JWT token to extract user information.\n */\nexport function decodeToken(token: string): User | null {\n  try {\n    const payload = JSON.parse(atob(token.split('.')[1]));\n    return {\n      sub: payload.sub,\n      name: payload.name,\n      preferred_username: payload.preferred_username,\n      email: payload.email,\n    };\n  } catch (e) {\n    console.error('Failed to decode token:', e);\n    return null;\n  }\n}\n\n/**\n * Get user information from stored token.\n */\nexport function getUserFromToken(): User | null {\n  const token = getToken();\n  if (!token) {\n    return null;\n  }\n  return decodeToken(token);\n}\n\n"],"names":["module","exports","require","vendored","ReactJsxRuntime","ReactDOM"],"mappings":"mKAAAA,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEC,eAAe,+BCFxCJ,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,YAAY,CAAEE,QAAQ,wGCEjC,IAAA,EAAA,EAAA,CAAA,CAAA,OCUO,SAAS,EAAW,CAAa,EAIxC,CAKO,SAAS,IAId,OAAO,IACT,CAKO,SAAS,IAIhB,CAKO,SAAS,EAAY,CAAa,EACvC,GAAI,CACF,IAAM,EAAU,KAAK,KAAK,CAAC,KAAK,EAAM,KAAK,CAAC,IAAI,CAAC,EAAE,GACnD,MAAO,CACL,IAAK,EAAQ,GAAG,CAChB,KAAM,EAAQ,IAAI,CAClB,mBAAoB,EAAQ,kBAAkB,CAC9C,MAAO,EAAQ,KACjB,AADsB,CAExB,CAAE,MAAO,EAAG,CAEV,OADA,QAAQ,KAAK,CAAC,0BAA2B,GAClC,IACT,CACF,yFDzCA,IAAM,EACJ,QAAQ,GAAG,CAAC,8BAA8B,EAAI,GAC1C,EACJ,QAAQ,GAAG,CAAC,6BAA6B,EAAI,GAExC,SAAS,IACd,GAAM,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACxC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAG5C,EAAmB,CAAC,CAAC,AAAC,IAAsB,CAAA,CAAiB,OAEnE,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KAGN,IAAM,EAAc,IACpB,GAAI,EAAa,CACf,EAAS,GACT,IAAM,EAAc,EAAY,GAC5B,EACF,EAAQ,IAGR,IACA,CALe,CAKN,MACT,EAAQ,MAEZ,MACE,CADK,CACI,MACT,EAAQ,MAEV,GAAW,EAIf,EAAG,EAAE,EAiDE,CACL,aACA,UACA,EACA,gBAAiB,CAAC,CAAC,GAAQ,CAAC,CAAC,EAC7B,MApDY,KAEZ,AAAK,GAMe,CANhB,cAAmB,IAOrB,AAEI,IAEQ,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,OAHnC,EAG4C,CAAC,IAVjD,QAAQ,IAAI,CAAC,4BA2BjB,EAuBE,OArBa,KACb,IACA,EAAS,MACT,EAAQ,KACV,EAkBE,aAhBmB,AAAC,IACpB,EAAW,GACX,EAAS,GACT,IAAM,EAAc,EAAY,GAC5B,GACF,EAAQ,EAEZ,CAUA,CACF,IAdqB","ignoreList":[0,1]}