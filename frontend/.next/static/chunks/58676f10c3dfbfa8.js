(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,24136,38036,e=>{"use strict";var t=e.i(47167),r=e.i(71645);let n="auth_token";function o(e){localStorage.setItem(n,e)}function i(){return localStorage.getItem(n)}function s(){localStorage.removeItem(n)}function a(e){try{let t=JSON.parse(atob(e.split(".")[1]));return{sub:t.sub,name:t.name,preferred_username:t.preferred_username,email:t.email}}catch(e){return console.error("Failed to decode token:",e),null}}e.s(["clearToken",()=>s,"decodeToken",()=>a,"getToken",()=>i,"storeToken",()=>o],38036);let l=t.default.env.NEXT_PUBLIC_ZITADEL_ISSUER_URL||"",c=t.default.env.NEXT_PUBLIC_ZITADEL_CLIENT_ID||"";function u(){let[e,t]=(0,r.useState)(null),[n,u]=(0,r.useState)(!0),[d,m]=(0,r.useState)(null),h=!!(l&&c);return(0,r.useEffect)(()=>{let e=i();if(e){m(e);let r=a(e);r?t(r):(s(),m(null),t(null))}else m(null),t(null);u(!1)},[]),{user:e,token:d,loading:n,isAuthenticated:!!e&&!!d,login:()=>{if(!h)return void console.warn("Zitadel is not configured");let e=encodeURIComponent(`${window.location.origin}/auth/callback`),t=Math.random().toString(36).substring(7);sessionStorage.setItem("oauth_state",t);let r=`${l}/oauth/v2/authorize?client_id=${c}&redirect_uri=${e}&response_type=code&scope=openid profile email&state=${t}`;window.location.href=r},logout:()=>{s(),m(null),t(null)},setAuthToken:e=>{o(e),m(e);let r=a(e);r&&t(r)}}}e.s(["useAuth",()=>u],24136)},57222,e=>{"use strict";var t=e.i(43476),r=e.i(71645),n=e.i(18566),o=e.i(24136);function i(){let e=(0,n.useRouter)(),i=(0,n.useSearchParams)(),{setAuthToken:s}=(0,o.useAuth)(),[a,l]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{let t=i.get("error");if(t){l(`Authentication error: ${t}`),setTimeout(()=>e.push("/"),3e3);return}let r=i.get("code");if(!r){l("No authorization code received"),setTimeout(()=>e.push("/"),3e3);return}try{let t=`${window.location.origin}/auth/callback`,n=await fetch("/api/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r,redirectUri:t})});if(!n.ok){let e=await n.json();throw Error(e.error||"Token exchange failed")}let o=await n.json();if(!o.token)throw Error("No token received from server");s(o.token),e.push("/")}catch(t){console.error("Callback error:",t),l(t instanceof Error?t.message:"Authentication failed"),setTimeout(()=>e.push("/"),3e3)}})()},[i,e,s]),a)?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-destructive mb-4",children:"Authentication Error"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:a}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-4",children:"Redirecting to home page..."})]})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Completing authentication..."})]})})}function s(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]})}),children:(0,t.jsx)(i,{})})}e.s(["default",()=>s])}]);